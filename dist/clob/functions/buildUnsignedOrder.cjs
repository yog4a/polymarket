"use strict";var d=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var i=(e,r)=>d(e,"name",{value:r,configurable:!0});var N=(e,r)=>{for(var a in r)d(e,a,{get:r[a],enumerable:!0})},I=(e,r,a,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of y(r))!w.call(e,o)&&o!==a&&d(e,o,{get:()=>r[o],enumerable:!(t=R(r,o))||t.enumerable});return e};var z=e=>I(d({},"__esModule",{value:!0}),e);var U={};N(U,{buildUnsignedOrder:()=>F});module.exports=z(U);var s=require("@polymarket/order-utils"),L=require("@polymarket/clob-client");var g={"0.1":{price:1,size:2,amount:3},"0.01":{price:2,size:2,amount:4},"0.001":{price:3,size:2,amount:5},"0.0001":{price:4,size:2,amount:6}};var k=require("viem");var x=require("viem");var c=i(e=>{if(Number.isInteger(e))return 0;let r=e.toString().split(".");return r.length<=1?0:r[1].length},"decimalPlaces"),A=i((e,r)=>c(e)<=r?e:Math.round((e+Number.EPSILON)*10**r)/10**r,"roundNormal"),m=i((e,r)=>c(e)<=r?e:Math.floor(e*10**r)/10**r,"roundDown"),u=i((e,r)=>c(e)<=r?e:Math.ceil(e*10**r)/10**r,"roundUp"),l=i((e,r)=>{let a=parseFloat(r);return e>=a&&e<=1-a},"priceValid");function b(e,r,a,t){let o=A(a,t.price);if(e===s.Side.BUY){let p=m(r,t.size),n=p*o;return c(n)>t.amount&&(n=u(n,t.amount+4),c(n)>t.amount&&(n=m(n,t.amount))),{rawMakerAmt:n,rawTakerAmt:p,side:s.Side.BUY}}else if(e===s.Side.SELL){let p=m(r,t.size),n=p*o;return c(n)>t.amount&&(n=u(n,t.amount+4),c(n)>t.amount&&(n=m(n,t.amount))),{rawMakerAmt:p,rawTakerAmt:n,side:s.Side.SELL}}throw new Error(`Invalid side: ${e}`)}i(b,"getOrderRawAmounts");function f(e){return(0,x.parseUnits)(e.toString(),6).toString()}i(f,"toCollateralUnits");function F(e){let{signerAddress:r,makerAddress:a,userOrder:t,resolved:o}=e,p=e.signatureType??s.SignatureType.EOA;if(!l(t.price,o.tickSize))throw new Error(`invalid price (${t.price}), min: ${o.tickSize} - max: ${1-parseFloat(o.tickSize)}`);let n;typeof t.taker<"u"&&t.taker?n=t.taker:n=k.zeroAddress;let E=g[o.tickSize],{rawMakerAmt:O,rawTakerAmt:C,side:S}=b(t.side,t.size,t.price,E),T=f(O),D=f(C);return{maker:a,taker:n,tokenId:t.tokenID,makerAmount:T,takerAmount:D,side:S,feeRateBps:(o.feeRateBps??"0").toString(),nonce:(t.nonce??"0").toString(),signer:r,expiration:(t.expiration??0).toString(),signatureType:p}}i(F,"buildUnsignedOrder");0&&(module.exports={buildUnsignedOrder});
